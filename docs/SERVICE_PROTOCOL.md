# ShareX Settlement Service - ì™„ì „í•œ í”„ë¡œí† ì½œ

## Phase 1: MVP ì™„ë£Œ (í˜„ì¬)
- [x] PDF ì—…ë¡œë“œ ë° íŒŒì‹±
- [x] ê¸°ì—…ë³„ ì •ì‚° ê³„ì‚°
- [x] í”ŒëŸ¬ìŠ¤ì—‘ìŠ¤ ë¹„ìœ¨ ê¸°ê°„ë³„ ì ìš© (70% â†’ 65%)
- [x] ì›¹ UI ì •ì‚°ì„œ ìƒì„¸ ë³´ê¸°
- [x] êµì°¨ê²€ì¦ ëª¨ë¸
- [x] Remarks ì…ë ¥ ë° ì €ì¥
- [x] ì•„ì¹´ì´ë¸Œ ì €ì¥ (ë¡œì»¬ JSON)

## Phase 2: ìƒíƒœ ê´€ë¦¬ ë° ì›Œí¬í”Œë¡œìš° (í•„ìˆ˜)

### 2.1 ìŠ¹ì¸ ìƒíƒœ ì¶”ì 
**í•„ìš”ì„±:** ì–´ë–¤ ê¸°ì—…ì´ ìŠ¹ì¸ë˜ì—ˆëŠ”ì§€ ë¦¬ìŠ¤íŠ¸ì—ì„œ êµ¬ë¶„
**êµ¬í˜„:**
```typescript
// archive JSONì— approval_status ì¶”ê°€
{
  "period": "2025-Q1",
  "companies": {...},
  "approval_status": {
    "plusx": {
      "approved": true,
      "approved_at": "2025-02-12T15:30:00",
      "approved_by": "admin",
      "pdf_generated": true,
      "pdf_path": "output/2025-Q1/ì‰ì–´ì—‘ìŠ¤_í”ŒëŸ¬ìŠ¤ì—‘ìŠ¤_2025ë…„_1Q_ì •ì‚°ì„œ.pdf"
    },
    "bkid": {
      "approved": false,
      "reviewed": true,
      "remarks_updated_at": "2025-02-12T14:20:00"
    }
  }
}
```

**UI ë³€ê²½:**
- ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸”: ìŠ¹ì¸ ìƒíƒœ ì»¬ëŸ¼ ì¶”ê°€ (`âœ… ìŠ¹ì¸ ì™„ë£Œ` / `ğŸ”„ ê²€í†  ì¤‘` / `â³ ëŒ€ê¸°`)
- ìƒì„¸ í˜ì´ì§€: ìŠ¹ì¸ ì™„ë£Œ ì‹œ "ìµœì¢… ìŠ¹ì¸" ë²„íŠ¼ â†’ "PDF ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½

### 2.2 PDF ìƒì„± ì™„ë£Œ ì•Œë¦¼
**í˜„ì¬:** Task IDë§Œ í‘œì‹œ, ì™„ë£Œ ì—¬ë¶€ í™•ì¸ ë¶ˆê°€
**ê°œì„ :**
```typescript
// ë°±ê·¸ë¼ìš´ë“œ í´ë§ìœ¼ë¡œ Task ìƒíƒœ ì²´í¬
useEffect(() => {
  if (taskId) {
    const interval = setInterval(async () => {
      const status = await getTaskStatus(taskId);
      if (status.status === "completed") {
        setDownloadUrl(status.results.pdf_path);
        clearInterval(interval);
      }
    }, 2000);
    return () => clearInterval(interval);
  }
}, [taskId]);
```

### 2.3 ì•„ì¹´ì´ë¸Œ ëª©ë¡ í˜ì´ì§€
**í˜„ì¬:** ì €ì¥ëœ ë°ì´í„° í™•ì¸ ë¶ˆê°€
**ì‹ ê·œ í˜ì´ì§€:** `/projects/settlement/archives`
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì €ì¥ëœ ì •ì‚° ì•„ì¹´ì´ë¸Œ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2025-Q1  â”‚ 12ê°œ ê¸°ì—…  â”‚ 10ê°œ ìŠ¹ì¸  â”‚ ë¶ˆëŸ¬ì˜¤ê¸° â”‚
â”‚ 2024-Q4  â”‚ 11ê°œ ê¸°ì—…  â”‚ 11ê°œ ìŠ¹ì¸  â”‚ ë¶ˆëŸ¬ì˜¤ê¸° â”‚
â”‚ 2024-Q3  â”‚  9ê°œ ê¸°ì—…  â”‚  8ê°œ ìŠ¹ì¸  â”‚ ë¶ˆëŸ¬ì˜¤ê¸° â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Phase 3: ì´ë©”ì¼ ë°œì†¡ ìë™í™”

### 3.1 SMTP ì—°ë™
```python
# backend.py
@app.post("/api/settlements/send-email")
async def send_settlement_email(
    period: str,
    company_id: str,
    recipient_email: str,
    pdf_path: str
):
    # SendGrid, AWS SES, ë˜ëŠ” Gmail SMTP ì‚¬ìš©
    subject = f"[ShareX] {period} ì •ì‚°ì„œ"
    body = f"{company_info.name}ë‹˜ê»˜ {period} ì •ì‚°ì„œë¥¼ ì†¡ë¶€ë“œë¦½ë‹ˆë‹¤."
    attachment = pdf_path

    send_email(to=recipient_email, subject=subject, body=body, attachment=attachment)

    # ë°œì†¡ ê¸°ë¡ ì €ì¥
    email_log = {
        "period": period,
        "company_id": company_id,
        "sent_at": datetime.now().isoformat(),
        "recipient": recipient_email,
        "status": "sent"
    }
```

### 3.2 ì¼ê´„ ë°œì†¡ ê¸°ëŠ¥
- ìŠ¹ì¸ëœ ëª¨ë“  ê¸°ì—…ì—ê²Œ ìë™ ë°œì†¡
- ë°œì†¡ ì „ ë¯¸ë¦¬ë³´ê¸°
- ë°œì†¡ ê¸°ë¡ ì¶”ì 

## Phase 4: ìƒˆ PDF ì–‘ì‹ íŒŒì„œ (2025-Q4 í˜•ì‹)

**í˜„ì¬:** 2024-Q4, 2025-Q1 ì–‘ì‹ë§Œ ì§€ì›
**í•„ìš”:** 2025-Q4 ì‹ ê·œ ì–‘ì‹ íŒŒì„œ

```python
# src/parsers/fastcampus_pdf_v2.py
def parse_new_format(pdf_path: str):
    # í…Œì´ë¸” ê¸°ë°˜ ì¶”ì¶œ (pdfplumber.extract_tables())
    # ì»¬ëŸ¼: í•­ëª© / ë§¤ì¶œì•¡ / í”„ë¡œëª¨ì…˜ ë§¤ì¶œì•¡ / ì œì‘ë¹„ / ë§ˆì¼€íŒ…ë¹„ / ê³„ì•½ì¡°ê±´ / ì •ì‚°ê¸ˆì•¡
    # ì½”ìŠ¤ ID: YYMM_ prefix íŒŒì‹±
    # ê¸°ì—… í˜¼í•© ë°°ì¹˜: í–‰ë³„ë¡œ ê¸°ì—… ë¶„ë¥˜ ë¡œì§
    pass
```

## Phase 5: ëŒ€ì‹œë³´ë“œ ë° ë¶„ì„

### 5.1 ë©”ì¸ ëŒ€ì‹œë³´ë“œ (`/projects/settlement/dashboard`)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì—°ê°„ ì •ì‚° í†µê³„ (2025ë…„)                                â”‚
â”‚  â”œâ”€ ì´ ì •ì‚° ê¸ˆì•¡: â‚©1,234,567,890                       â”‚
â”‚  â”œâ”€ ë¶„ê¸°ë³„ ì¶”ì´: [Q1] â‚©300M  [Q2] â‚©280M  ...           â”‚
â”‚  â””â”€ ê¸°ì—…ë³„ ë¹„ì¤‘: í”ŒëŸ¬ìŠ¤ì—‘ìŠ¤ 45% | í—ˆìŠ¤í‚¤í­ìŠ¤ 12% | ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê°•ì˜ ë§¤ì¶œ TOP 10                                       â”‚
â”‚  1. BX ì‹¤ë¬´ ë§ˆìŠ¤í„° - â‚©180M                              â”‚
â”‚  2. UI ì‹¤ë¬´ ë§ˆìŠ¤í„° - â‚©120M                              â”‚
â”‚  ...                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ë¶„ì„ ê¸°ëŠ¥
- ê¸°ì—…ë³„ ë§¤ì¶œ ì¶”ì´ (ë¶„ê¸°ë³„ ë¼ì¸ ì°¨íŠ¸)
- ê°•ì˜ë³„ ìˆ˜ìµë¥  ë¶„ì„
- ë§ˆì¼€íŒ…ë¹„ ëŒ€ë¹„ ë§¤ì¶œ íš¨ìœ¨

## Phase 6: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

**í˜„ì¬:** ë¡œì»¬ JSON íŒŒì¼ (`data/archive/`)
**ëª©í‘œ:** í´ë¼ìš°ë“œ DB

### ì˜µì…˜ 1: PostgreSQL (Supabase/Vercel Postgres)
```sql
CREATE TABLE settlements (
  id UUID PRIMARY KEY,
  period VARCHAR(10) NOT NULL,
  company_id VARCHAR(50) NOT NULL,
  revenue DECIMAL,
  settlement_amount DECIMAL,
  approved BOOLEAN DEFAULT FALSE,
  approved_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE settlement_pdfs (
  id UUID PRIMARY KEY,
  period VARCHAR(10),
  company_id VARCHAR(50),
  pdf_url TEXT,
  generated_at TIMESTAMP
);
```

### ì˜µì…˜ 2: Firebase Firestore (NoSQL)
```javascript
// settlements/{period}/{companyId}
{
  period: "2025-Q1",
  companyId: "plusx",
  revenue: 149773988,
  settlement_amount: 104841792,
  approved: true,
  pdfUrl: "https://storage.../plusx_2025Q1.pdf"
}
```

## Phase 7: ì‚¬ìš©ì ì¸ì¦ ë° ê¶Œí•œ

**í˜„ì¬:** ì¸ì¦ ì—†ìŒ (ë¡œì»¬ ì „ìš©)
**í•„ìš”:**
- ê´€ë¦¬ì ë¡œê·¸ì¸
- íšŒì‚¬ë³„ ì œí•œëœ ì ‘ê·¼ (ê° ê¸°ì—…ì€ ìê¸° ì •ì‚°ì„œë§Œ ì¡°íšŒ)
- ìŠ¹ì¸ ê¶Œí•œ ë¶„ë¦¬ (ì¬ë¬´íŒ€ë§Œ ìµœì¢… ìŠ¹ì¸ ê°€ëŠ¥)

**êµ¬í˜„:** Next.js Auth.js + JWT

---

## ìš°ì„ ìˆœìœ„ ë¡œë“œë§µ

### ğŸ”¥ Critical (ì¦‰ì‹œ í•„ìš”)
1. **ìŠ¹ì¸ ìƒíƒœ ì¶”ì ** (Phase 2.1)
2. **ì•„ì¹´ì´ë¸Œ ëª©ë¡ í˜ì´ì§€** (Phase 2.3)
3. **PDF ë‹¤ìš´ë¡œë“œ ë§í¬ ì œê³µ** (Phase 2.2)

### ğŸš€ High (1-2ì£¼ ë‚´)
4. **ìƒˆ PDF ì–‘ì‹ íŒŒì„œ** (Phase 4)
5. **ì´ë©”ì¼ ë°œì†¡** (Phase 3)

### ğŸ“Š Medium (1-2ê°œì›”)
6. **ëŒ€ì‹œë³´ë“œ** (Phase 5)
7. **DB ë§ˆì´ê·¸ë ˆì´ì…˜** (Phase 6)

### ğŸ” Low (í–¥í›„)
8. **ì‚¬ìš©ì ì¸ì¦** (Phase 7)

---

## ê¸°ìˆ  ìŠ¤íƒ ìµœì¢… ê¶Œì¥

### Backend
- FastAPI (í˜„ì¬ ìœ ì§€)
- PostgreSQL (Supabase ë˜ëŠ” Vercel Postgres)
- Redis (Task Queue ê°œì„ )

### Frontend
- Next.js 16 (í˜„ì¬ ìœ ì§€)
- React Query (ì„œë²„ ìƒíƒœ ê´€ë¦¬)
- Chart.js (ëŒ€ì‹œë³´ë“œ ì°¨íŠ¸)

### Infrastructure
- Vercel (Frontend ë°°í¬)
- Railway/Render (FastAPI ë°°í¬)
- Supabase (DB + Storage)
- SendGrid/AWS SES (ì´ë©”ì¼)

---

## ì˜ˆìƒ ê°œë°œ ì‹œê°„

| Phase | ì‘ì—… | ì˜ˆìƒ ì‹œê°„ |
|-------|------|-----------|
| 2.1   | ìŠ¹ì¸ ìƒíƒœ ì¶”ì  | 4h |
| 2.2   | PDF ë‹¤ìš´ë¡œë“œ | 2h |
| 2.3   | ì•„ì¹´ì´ë¸Œ ëª©ë¡ | 3h |
| 3     | ì´ë©”ì¼ ë°œì†¡ | 8h |
| 4     | ìƒˆ íŒŒì„œ | 12h |
| 5     | ëŒ€ì‹œë³´ë“œ | 16h |
| 6     | DB ë§ˆì´ê·¸ë ˆì´ì…˜ | 20h |

**Total MVP â†’ Production:** ~65ì‹œê°„ (ì•½ 2ì£¼)
